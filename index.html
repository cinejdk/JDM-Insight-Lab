<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JDM Insight Lab</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg-color: #121212;
            --panel-bg: #1e1e1e;
            --input-bg: #2c2c2c;
            --text-main: #e0e0e0;
            --text-sub: #a0a0a0;
            --accent: #4CAF50; /* í¸ì•ˆí•œ ë…¹ìƒ‰ */
            --border: #333;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        /* ë ˆì´ì•„ì›ƒ: ë°ìŠ¤í¬íƒ‘ì—ì„œëŠ” ì¢Œìš° ë¶„í•  */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 25px;
            align-items: start;
        }

        /* ëª¨ë°”ì¼ì—ì„œëŠ” ìƒí•˜ ë°°ì¹˜ */
        @media (max-width: 900px) {
            .container { grid-template-columns: 1fr; }
        }

        h2 { margin-top: 0; border-bottom: 1px solid var(--border); padding-bottom: 10px; font-size: 1.2rem;}

        /* --- [ì™¼ìª½] ì…ë ¥ íŒ¨ë„ --- */
        .input-panel {
            background-color: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
            position: sticky;
            top: 20px;
        }

        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; color: var(--accent); margin-bottom: 6px; font-weight: 600; font-size: 0.9rem; }
        
        input[type="text"], textarea {
            width: 100%;
            background-color: var(--input-bg);
            border: 1px solid var(--border);
            color: #fff;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
            transition: 0.2s;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            background-color: #363636;
        }

        #inputContext { height: 70px; resize: none; }
        #inputResponse { 
            height: 400px; 
            font-family: 'Consolas', monospace; 
            line-height: 1.5; 
            resize: vertical; 
        }

        .btn-save {
            width: 100%;
            padding: 14px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn-save:hover { background-color: #45a049; }

        /* --- [ì˜¤ë¥¸ìª½] ë·°ì–´ íŒ¨ë„ --- */
        .view-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* ê²€ìƒ‰ ë° í•„í„° */
        .search-bar {
            background-color: var(--panel-bg);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        /* ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ */
        .card-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .insight-card {
            background-color: var(--panel-bg);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 25px;
            position: relative;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }

        .card-context {
            font-size: 1.1rem;
            font-weight: bold;
            color: #fff;
            flex: 1;
        }

        .card-meta {
            font-size: 0.8rem;
            color: var(--text-sub);
            margin-left: 15px;
            white-space: nowrap;
        }

        /* ë§ˆí¬ë‹¤ìš´ ì½˜í…ì¸  ìŠ¤íƒ€ì¼ */
        .card-body {
            color: #ddd;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .card-body h1, .card-body h2, .card-body h3 { border-bottom: none; margin-top: 20px; color: #fff; }
        .card-body code { background: #333; padding: 2px 5px; border-radius: 4px; color: #ff9800; font-family: monospace; }
        .card-body pre { background: #111; padding: 15px; border-radius: 8px; overflow-x: auto; }
        .card-body blockquote { border-left: 4px solid var(--accent); margin: 0; padding-left: 15px; color: #aaa; }
        .card-body ul, .card-body ol { padding-left: 20px; }

        /* íƒœê·¸ ì˜ì—­ */
        .card-tags {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #333;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .tag {
            font-size: 0.75rem;
            background-color: #2c2c2c;
            color: var(--accent);
            padding: 4px 10px;
            border-radius: 15px;
            border: 1px solid #444;
        }

        .btn-delete {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .btn-delete:hover { color: #ff5252; }
    </style>
</head>
<body>

<div class="container">
    
    <div class="input-panel">
        <h2>ğŸ§ª JDM Insight Lab</h2>
        
        <div class="input-group">
            <label for="inputContext">1. Context (ì§ˆë¬¸ ì˜ë„ & ë§¥ë½)</label>
            <textarea id="inputContext" placeholder="ì™œ ì´ ì§ˆë¬¸ì„ í–ˆë‚˜ìš”? ë‹¹ì‹œì˜ ê³ ë¯¼ì´ë‚˜ ìƒí™©ì„ ì§§ê²Œ ê¸°ë¡í•˜ì„¸ìš”."></textarea>
        </div>

        <div class="input-group">
            <label for="inputResponse">2. Gemini Response (í•µì‹¬ ë‹µë³€)</label>
            <textarea id="inputResponse" placeholder="ì›Œë“œ/í•œê¸€ì—ì„œ ë³µì‚¬í•œ í…ìŠ¤íŠ¸ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
        </div>

        <div class="input-group">
            <label for="inputTags">3. Tags (ë¶„ë¥˜)</label>
            <input type="text" id="inputTags" placeholder="#ê±´ì„¤ì‹¤ë¬´ #ì² í•™ #ì½”ë“œ #ìŒì•… (ë„ì–´ì“°ê¸°ë¡œ êµ¬ë¶„)">
        </div>

        <button class="btn-save" onclick="saveInsight()">ì €ì¥í•˜ê¸° (Save)</button>
        
        <div style="margin-top: 20px; font-size: 0.8rem; color: #666; text-align: center;">
            ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €(Local Storage)ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤.
        </div>
    </div>

    <div class="view-panel">
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="ê²€ìƒ‰: í‚¤ì›Œë“œ ë˜ëŠ” #íƒœê·¸ ì…ë ¥..." onkeyup="filterInsights()">
        </div>

        <div id="cardList" class="card-list">
            </div>
    </div>

</div>

<script>
    // ì €ì¥ì†Œ í‚¤ ì´ë¦„ (ê¸°ì¡´ ì•„ì¹´ì´ë¸Œì™€ ì„ì´ì§€ ì•Šê²Œ ê³ ìœ í•œ ì´ë¦„ ì‚¬ìš©)
    const STORAGE_KEY = 'jdm_insight_lab_v1';
    let insights = [];

    // 1. ì´ˆê¸° ë¡œë“œ
    window.onload = function() {
        const savedData = localStorage.getItem(STORAGE_KEY);
        if (savedData) {
            insights = JSON.parse(savedData);
        }
        renderInsights(insights);
    };

    // 2. ì €ì¥ í•¨ìˆ˜
    function saveInsight() {
        const context = document.getElementById('inputContext').value.trim();
        const response = document.getElementById('inputResponse').value.trim();
        const tagsInput = document.getElementById('inputTags').value.trim();

        if (!context || !response) {
            alert('ë§¥ë½(Context)ê³¼ ë‹µë³€(Response)ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
            return;
        }

        // íƒœê·¸ ì²˜ë¦¬: #ì„ ì œê±°í•˜ê³  ê³µë°±ìœ¼ë¡œ ë¶„ë¦¬
        const tags = tagsInput.split(/[\s,]+/)
            .filter(t => t.length > 0)
            .map(t => t.startsWith('#') ? t : '#' + t);

        const newInsight = {
            id: Date.now(),
            date: new Date().toLocaleString('ko-KR'),
            context: context,
            response: response,
            tags: tags
        };

        // ë°°ì—´ ì•ì— ì¶”ê°€ (ìµœì‹ ìˆœ)
        insights.unshift(newInsight);
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥
        localStorage.setItem(STORAGE_KEY, JSON.stringify(insights));

        // ì…ë ¥ì°½ ì´ˆê¸°í™”
        document.getElementById('inputContext').value = '';
        document.getElementById('inputResponse').value = '';
        document.getElementById('inputTags').value = '';

        // í™”ë©´ ê°±ì‹ 
        renderInsights(insights);
    }

    // 3. í™”ë©´ ë Œë”ë§ (Markdown ë³€í™˜ í¬í•¨)
    function renderInsights(data) {
        const listContainer = document.getElementById('cardList');
        listContainer.innerHTML = '';

        data.forEach(item => {
            const card = document.createElement('div');
            card.className = 'insight-card';

            // ë§ˆí¬ë‹¤ìš´ ë³€í™˜
            const parsedContent = marked.parse(item.response);

            // íƒœê·¸ HTML ìƒì„±
            const tagsHtml = item.tags.map(tag => `<span class="tag">${tag}</span>`).join('');

            card.innerHTML = `
                <div class="card-header">
                    <div class="card-context">Q. ${item.context}</div>
                    <div class="card-meta">${item.date}</div>
                    <button class="btn-delete" onclick="deleteInsight(${item.id})">ì‚­ì œ</button>
                </div>
                <div class="card-body">
                    ${parsedContent}
                </div>
                <div class="card-tags">
                    ${tagsHtml}
                </div>
            `;
            listContainer.appendChild(card);
        });
    }

    // 4. ì‚­ì œ í•¨ìˆ˜
    function deleteInsight(id) {
        if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            insights = insights.filter(item => item.id !== id);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(insights));
            renderInsights(insights);
        }
    }

    // 5. ê²€ìƒ‰ ë° í•„í„° í•¨ìˆ˜
    function filterInsights() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        
        const filtered = insights.filter(item => {
            const textMatch = item.context.toLowerCase().includes(query) || 
                              item.response.toLowerCase().includes(query);
            const tagMatch = item.tags.some(tag => tag.toLowerCase().includes(query));
            return textMatch || tagMatch;
        });

        renderInsights(filtered);
    }
</script>

</body>
</html>
